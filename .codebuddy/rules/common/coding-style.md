# 编码风格

## 不可变性（关键）

始终创建新对象，永不修改现有对象：

```
// 伪代码
错误：  modify(original, field, value) → 原地修改original
正确： update(original, field, value) → 返回带有修改的新副本
```

原理：不可变数据可防止隐藏的副作用，使调试更容易，并支持安全的并发。

## 文件组织

多个小文件 > 少量大文件：
- 高内聚，低耦合
- 通常200-400行，最多800行
- 从大模块中提取工具函数
- 按功能/领域组织，而非按类型

## 错误处理

始终全面处理错误：
- 在每一层显式处理错误
- 在面向UI的代码中提供用户友好的错误消息
- 在服务端记录详细的错误上下文
- 永不静默吞掉错误

## 输入验证

始终在系统边界进行验证：
- 处理前验证所有用户输入
- 尽可能使用基于schema的验证
- 快速失败并提供清晰的错误消息
- 永不信任外部数据（API响应、用户输入、文件内容）

## 代码质量检查清单

完成工作前确认：
- [ ] 代码可读且命名良好
- [ ] 函数小（<50行）
- [ ] 文件专注（<800行）
- [ ] 无深层嵌套（>4层）
- [ ] 正确的错误处理
- [ ] 无硬编码值（使用常量或配置）
- [ ] 无变更（使用不可变模式）
