# 需求分析 Skill

## 角色定位

需求分析是软件开发的起点，确保需求清晰、完整、可测试、可追溯。

## 核心原则

1. **明确性** - 需求描述清晰，无歧义
2. **完整性** - 覆盖所有相关方面（功能、非功能、边界、异常）
3. **可测试性** - 每个需求都应该可以测试
4. **可追溯性** - 确保需求可以追溯到设计和实现
5. **优先级** - 明确需求的优先级（P0/P1/P2）
6. **用户视角** - 从用户角度描述需求，而非技术实现

## 需求提取方法

### 1. 用户故事

**格式：**
```
作为 [角色]，我想要 [功能]，以便 [价值]
```

**示例：**
- 作为用户，我想要使用邮箱和密码登录，以便访问我的账户
- 作为管理员，我想要查看用户列表，以便管理用户

### 2. 用例分析

描述用户如何使用系统完成目标：
1. 识别用户角色
2. 识别用户目标
3. 描述用户操作流程
4. 识别前置条件和后置条件

### 3. 场景分析

考虑三种场景：
- **正常场景** - 用户按照预期方式使用系统
- **异常场景** - 出现错误或异常的情况
- **边界场景** - 极端或边界条件

## 需求分类

### 1. 功能需求

描述系统应该做什么：

| 类型 | 说明 | 示例 |
|------|------|------|
| 核心功能 | 系统的主要功能 | 用户登录、注册、登出 |
| 辅助功能 | 支持核心功能的功能 | 密码重置、记住我 |
| 管理功能 | 管理员功能 | 用户管理、系统配置 |

### 2. 非功能需求

描述系统如何工作：

| 类型 | 说明 | 示例 |
|------|------|------|
| 性能需求 | 响应时间、吞吐量 | API 响应时间 < 200ms |
| 安全性需求 | 认证、授权、加密 | 密码必须加密存储 |
| 可用性需求 | 正常运行时间 | 99.9% 可用性 |
| 可扩展性需求 | 用户规模、数据规模 | 支持 100 万用户 |
| 兼容性需求 | 浏览器、设备 | 支持 Chrome、Firefox、Safari |

### 3. 约束条件

限制实现选择的条件：

| 类型 | 说明 | 示例 |
|------|------|------|
| 技术约束 | 技术栈限制 | 必须使用 PostgreSQL |
| 时间约束 | 交付时间限制 | 2 周内完成 |
| 资源约束 | 人力、预算限制 | 2 个开发人员 |
| 法规约束 | 合规性要求 | 符合 GDPR |

## 验收标准

### Given-When-Then 格式

**格式：**
```
Given [前置条件]
When [操作]
Then [预期结果]
```

**示例：**
- Given 用户在登录页面
- When 输入正确的邮箱和密码并点击登录
- Then 成功登录并跳转到首页

### 验收标准编写原则

1. **具体可测** - 可以通过测试验证
2. **独立** - 每个标准可以独立验证
3. **明确** - 清楚描述预期行为
4. **完整** - 覆盖所有重要场景

## 需求文档结构

```markdown
# 需求文档: [功能名称]

## 1. 需求概述
### 1.1 背景
### 1.2 目标
### 1.3 范围

## 2. 功能需求
### 2.1 核心功能
### 2.2 辅助功能

## 3. 非功能需求
### 3.1 性能需求
### 3.2 安全性需求
### 3.3 可用性需求
### 3.4 可扩展性需求
### 3.5 兼容性需求

## 4. 验收标准
### 4.1 功能验收标准
### 4.2 性能验收标准
### 4.3 安全性验收标准

## 5. 依赖与约束
### 5.1 依赖
### 5.2 约束

## 6. 边界情况
[边界情况列表]

## 7. 用户界面需求（如适用）
### 7.1 页面清单
### 7.2 交互流程

## 8. 数据需求（如适用）
### 8.1 数据输入
### 8.2 数据输出
### 8.3 数据存储

## 9. 集成需求（如适用）
### 9.1 API 集成
### 9.2 第三方服务集成

## 10. 测试需求
### 10.1 测试类型
### 10.2 测试数据

## 11. 上线需求
### 11.1 上线检查清单
### 11.2 回滚方案

## 12. 后续计划
### 12.1 第一期（MVP）
### 12.2 第二期
```

## 需求验证清单

完成需求文档后，检查：

### 基础验证
- [ ] 需求描述清晰，无歧义
- [ ] 包含所有功能需求
- [ ] 包含必要的非功能需求
- [ ] 每个需求都有验收标准
- [ ] 识别了所有依赖
- [ ] 识别了所有约束

### 质量验证
- [ ] 考虑了边界情况
- [ ] 考虑了异常场景
- [ ] 用户故事格式正确
- [ ] 验收标准使用 Given-When-Then 格式
- [ ] 优先级明确
- [ ] 范围清晰

### 可追溯性验证
- [ ] 每个功能需求都有对应的验收标准
- [ ] 每个非功能需求都有具体的指标
- [ ] 依赖和约束已识别

## 常见错误

### ❌ 避免的错误

1. **需求模糊**
   - 错误：提高性能
   - 正确：API 响应时间 < 200ms

2. **只有功能需求**
   - 错误：只有用户可以登录
   - 正确：用户可以登录，响应时间 < 500ms，密码使用 bcrypt 加密

3. **没有验收标准**
   - 错误：用户可以登录
   - 正确：用户可以登录，Given 用户在登录页面，When 输入正确的邮箱和密码并点击登录，Then 成功登录并跳转到首页

4. **使用技术术语**
   - 错误：用户发送 POST /api/auth/login 请求
   - 正确：用户在登录页面输入邮箱和密码并点击登录

5. **需求过多**
   - 错误：一个迭代包含 20 个功能
   - 正确：一个迭代包含 3-5 个核心功能

### ✅ 正确的做法

1. **需求具体可量化**
   - 响应时间 < 200ms
   - 支持 1000 并发用户
   - 正常运行时间 99.9%

2. **包含功能和非功能需求**
   - 功能：用户可以登录
   - 非功能：响应时间 < 500ms，密码使用 bcrypt 加密

3. **每个需求有明确的验收标准**
   - 使用 Given-When-Then 格式
   - 具体可测

4. **使用用户语言**
   - 从用户角度描述需求
   - 避免技术术语

5. **合理规划需求范围**
   - 按优先级划分（P0/P1/P2）
   - 分期交付（MVP -> 第二期 -> 第三期）

## 需求优先级

| 优先级 | 说明 | 处理方式 |
|--------|------|---------|
| **P0** | 必须有 | 第一期（MVP）必须实现 |
| **P1** | 应该有 | 第二期实现 |
| **P2** | 可以有 | 第三期或后续实现 |

## 需求变更流程

1. **提出变更**
   - 用户提出变更请求
   - 记录变更原因

2. **评估影响**
   - 评估对现有设计的影响
   - 评估对开发时间的影响
   - 评估对其他功能的影响

3. **更新文档**
   - 更新需求文档
   - 更新技术方案
   - 更新测试用例
   - 更新任务计划

4. **重新确认**
   - 展示更新后的需求文档
   - 等待用户确认

## 与其他文档的关系

```
需求文档
  ↓
技术方案文档
  ↓
测试用例文档
  ↓
任务计划
  ↓
代码实现
```

- 需求文档 → 技术方案文档：需求指导技术方案设计
- 需求文档 → 测试用例文档：需求生成测试用例
- 需求文档 → 代码实现：需求指导代码实现
- 测试用例 → 需求文档：测试验证需求是否满足

## 最佳实践

1. **从用户角度思考**
   - 用户遇到什么问题？
   - 用户想要什么？
   - 用户如何使用系统？

2. **考虑边界情况**
   - 输入为空
   - 输入过长
   - 输入包含特殊字符
   - 网络错误
   - 服务超时

3. **明确验收标准**
   - 使用 Given-When-Then 格式
   - 具体可测
   - 独立验证

4. **合理划分优先级**
   - P0：必须有
   - P1：应该有
   - P2：可以有

5. **分期交付**
   - 第一期：MVP（最小可行产品）
   - 第二期：核心体验
   - 第三期：边界情况
   - 第四期：优化

6. **保持可追溯性**
   - 需求 ID -> 设计 -> 测试 -> 代码
   - 确保每个需求都有对应的测试用例
   - 确保每个测试用例都有对应的代码实现

## 示例

### 示例 1：用户登录功能

```markdown
# 需求文档: 用户登录功能

## 1. 需求概述

### 1.1 背景
当前系统没有用户认证功能，需要添加登录功能以便用户可以访问受保护的资源。

### 1.2 目标
实现安全、易用的用户登录功能。

### 1.3 范围
包括：邮箱登录
不包括：第三方登录（后续添加）

## 2. 功能需求

### 2.1 核心功能

| ID | 用户故事 | 优先级 | 验收标准 |
|----|---------|--------|---------|
| FR-001 | 作为用户，我想要使用邮箱和密码登录，以便访问我的账户 | P0 | Given 用户在登录页面，When 输入正确的邮箱和密码并点击登录，Then 成功登录并跳转到首页 |
| FR-002 | 作为用户，我想要看到登录失败的错误提示，以便知道问题所在 | P0 | Given 用户在登录页面，When 输入错误的邮箱或密码并点击登录，Then 显示"邮箱或密码错误"提示 |

## 3. 非功能需求

### 3.1 性能需求
- 登录响应时间: < 500ms

### 3.2 安全性需求
- 密码使用 bcrypt 加密，强度至少 10
- 使用 HTTPS 协议
- 登录失败 5 次后锁定账户 30 分钟

## 4. 验收标准

### 4.1 功能验收标准

| ID | 标准 | 验收方法 |
|----|------|---------|
| AC-001 | Given 用户在登录页面，When 输入正确的邮箱和密码并点击登录，Then 成功登录并跳转到首页 | E2E 测试 |
| AC-002 | Given 用户在登录页面，When 输入错误的邮箱或密码并点击登录，Then 显示"邮箱或密码错误"提示 | E2E 测试 |

### 4.2 安全性验收标准

| ID | 标准 | 验收方法 |
|----|------|---------|
| AC-SEC-001 | 密码使用 bcrypt 加密，强度至少 10 | 代码审查 |
| AC-SEC-002 | 登录失败 5 次后锁定账户 | 安全扫描 |

## 5. 依赖与约束

### 5.1 依赖
- 数据库服务（PostgreSQL）

### 5.2 约束
- 技术栈: Node.js + Express + React
- 交付时间: 1 周

## 6. 边界情况

| 场景 | 描述 | 处理方式 |
|------|------|---------|
| BC-001 | 邮箱格式不正确 | 显示"邮箱格式不正确"提示 |
| BC-002 | 密码少于 8 位 | 显示"密码至少需要 8 位"提示 |
| BC-003 | 账户不存在 | 显示"邮箱或密码错误"提示（不透露账户是否存在） |
| BC-004 | 账户被锁定 | 显示"账户已被锁定，请 30 分钟后再试" |
```

## 总结

好的需求文档是成功项目的基础。确保需求：

- ✅ 清晰、具体、无歧义
- ✅ 包含功能和非功能需求
- ✅ 每个需求有明确的验收标准
- ✅ 识别了依赖和约束
- ✅ 考虑了边界情况和异常场景
- ✅ 从用户角度描述
- ✅ 优先级明确
- ✅ 可追溯

不要急于进入技术实现，先把需求搞清楚。
