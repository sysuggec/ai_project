---
name: plan
description: 需求分析与规划技能。当用户需要分析需求、制定设计方案、规划执行步骤时使用此技能。适用于新功能开发、系统设计、任务分解等场景。
---

# Plan 技能

## 概述

Plan 技能帮助用户将模糊的需求转化为清晰的设计方案和可执行的步骤计划。通过结构化的分析流程，确保需求理解准确、设计方案合理、执行步骤完整。

## 使用场景

- 用户提供新需求，需要分析和规划
- 需要将复杂任务分解为可执行的步骤
- 需要评估技术方案和实现路径
- 用户说"帮我规划一下"、"怎么实现"、"设计方案"等

## 工作流程

### 第一步：需求理解与澄清

1. **识别核心需求**
   - 用户想要解决什么问题？
   - 期望的最终结果是什么？
   - 有哪些约束条件（时间、技术栈、资源等）？

2. **澄清模糊点**
   - 对于不明确的需求，提出针对性问题
   - 确认优先级和范围
   - 了解现有系统上下文

### 第二步：现状分析

1. **代码库探索**
   - 分析现有代码结构和架构
   - 识别相关的模块、类、函数
   - 了解现有实现模式和约定

2. **技术评估**
   - 评估现有技术栈的能力
   - 识别潜在的技术风险
   - 确定需要引入的新依赖或技术

### 第三步：设计方案

1. **方案概述**
   - 提供清晰的设计思路
   - 说明方案选择的原因
   - 列出关键设计决策

2. **架构设计**
   - 模块划分和职责
   - 接口定义
   - 数据流和控制流

3. **备选方案**（可选）
   - 列出其他可行方案
   - 对比各方案的优劣
   - 给出推荐建议

### 第四步：执行计划

1. **任务分解**
   - 将实现分解为具体任务
   - 每个任务明确输入、输出和验收标准
   - 标注任务之间的依赖关系

2. **执行顺序**
   - 按依赖关系排序任务
   - 标识关键路径
   - 建议并行执行的任务

3. **里程碑定义**
   - 定义阶段性成果
   - 设置检查点
   - 预估工作量

## 输出格式

### 设计方案模板

```markdown
## 需求分析

### 核心需求
[描述核心需求]

### 约束条件
- [约束1]
- [约束2]

## 设计方案

### 方案概述
[方案的整体描述]

### 架构设计
[模块、接口、数据流的设计]

### 关键设计决策
1. [决策1]：[原因]
2. [决策2]：[原因]

## 执行计划

### 任务列表

| 序号 | 任务 | 描述 | 依赖 | 状态 |
|------|------|------|------|------|
| 1 | [任务名] | [描述] | - | 待开始 |
| 2 | [任务名] | [描述] | 1 | 待开始 |

### 里程碑
- [里程碑1]：[描述] - 完成任务 1-X
- [里程碑2]：[描述] - 完成任务 X-Y

## 风险与注意事项
- [风险1]：[应对措施]
- [风险2]：[应对措施]
```

## 最佳实践

### 需求分析

1. **由简入繁**：先理解表面需求，再挖掘深层需求
2. **假设显式化**：明确说明假设，便于用户纠正
3. **边界清晰**：明确范围，避免范围蔓延

### 设计方案

1. **KISS 原则**：优先选择简单有效的方案
2. **渐进增强**：先实现核心功能，再优化完善
3. **复用优先**：优先考虑复用现有代码和模式

### 执行计划

1. **粒度适中**：任务粒度以 1-4 小时为宜
2. **可验证**：每个任务都有明确的验收标准
3. **有回退**：考虑失败场景和回退方案

## 交互指南

1. **渐进式输出**：分阶段输出，每阶段确认用户反馈
2. **可视优先**：使用表格、列表等结构化格式
3. **控制信息量**：避免一次性输出过多内容
4. **主动确认**：关键决策点主动请求用户确认

## 示例

### 用户输入
> 我需要一个用户登录功能，支持手机号和邮箱登录

### Plan 技能输出

## 需求分析

### 核心需求
实现用户登录功能，支持手机号和邮箱两种登录方式。

### 澄清问题
1. 是否需要支持验证码登录？还是仅密码登录？
2. 是否需要记住登录状态？Token 有效期多久？
3. 是否需要登录失败次数限制？
4. 现有系统是否已有用户模块？

### 假设
- 用户表已存在
- 使用 JWT 进行身份认证
- Token 有效期 7 天

## 设计方案

### 方案概述
采用统一的登录接口，根据输入格式自动识别登录类型（手机号/邮箱），验证通过后返回 JWT Token。

### 架构设计

```
Controller (LoginController)
    ↓
Service (AuthService)
    ↓
Repository (UserRepository)
    ↓
Database (users table)
```

### 接口定义

```php
POST /api/auth/login
Request: { "account": "xxx", "password": "xxx" }
Response: { "token": "xxx", "user": {...} }
```

## 执行计划

| 序号 | 任务 | 描述 | 依赖 | 状态 |
|------|------|------|------|------|
| 1 | 创建 AuthService | 实现登录逻辑 | - | 待开始 |
| 2 | 添加账户格式验证 | 识别手机号/邮箱 | 1 | 待开始 |
| 3 | 实现 JWT 生成 | 创建 Token 服务 | 1 | 待开始 |
| 4 | 创建 LoginController | 暴露登录接口 | 1,2,3 | 待开始 |
| 5 | 添加登录失败限制 | 安全防护 | 4 | 待开始 |
| 6 | 编写单元测试 | 测试覆盖 | 1-5 | 待开始 |

### 里程碑
- MVP：完成任务 1-4，基本登录功能可用
- 完善：完成任务 5-6，功能完整且有测试保障

## 风险与注意事项
- 密码存储需使用 bcrypt 加密
- 需防止 SQL 注入和暴力破解
