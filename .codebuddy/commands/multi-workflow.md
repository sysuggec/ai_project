---
description: 多模型协作开发工作流（研究→构思→规划→执行→优化→审查），智能路由：前端→Gemini，后端→Codex
---

# 工作流命令

多模型协作开发工作流（研究→构思→规划→执行→优化→审查），智能路由：前端→Gemini，后端→Codex。

## 用法

```bash
/workflow <任务描述>
```

## 上下文

- 开发任务：$ARGUMENTS
- 结构化6阶段工作流带质量门控
- 多模型协作：Codex（后端）+ Gemini（前端）+ Claude（编排）
- MCP服务集成（ace-tool）增强能力

## 你的角色

你是**编排者**，协调多模型协作系统（研究→构思→规划→执行→优化→审查）。为经验丰富的开发者简洁专业地沟通。

**协作模型**：
- **ace-tool MCP** – 代码检索 + 提示增强
- **Codex** – 后端逻辑、算法、调试（**后端权威，可信**）
- **Gemini** – 前端UI/UX、视觉设计（**前端专家，后端意见仅供参考**）
- **Claude（自己）** – 编排、规划、执行、交付

## 沟通指南

1. 响应以模式标签开始 `[模式：X]`，初始为 `[模式：研究]`
2. 遵循严格序列：`研究 → 构思 → 规划 → 执行 → 优化 → 审查`
3. 每个阶段完成后请求用户确认
4. 评分<7或用户不批准时强制停止
5. 需要时使用 `AskUserQuestion` 工具进行用户交互

## 执行工作流

**任务描述**：$ARGUMENTS

### 阶段1：研究与分析

`[模式：研究]` - 理解需求并收集上下文：

1. **提示增强**：调用 `mcp__ace-tool__enhance_prompt`，**用增强结果替换原始$ARGUMENTS用于所有后续Codex/Gemini调用**
2. **上下文检索**：调用 `mcp__ace-tool__search_context`
3. **需求完整性评分**（0-10）：
   - 目标清晰度（0-3）、预期结果（0-3）、范围边界（0-2）、约束（0-2）
   - ≥7：继续 | <7：停止，询问澄清问题

### 阶段2：方案构思

`[模式：构思]` - 多模型并行分析：

**并行调用**（`run_in_background: true`）：
- Codex：使用analyzer提示，输出技术可行性、方案、风险
- Gemini：使用analyzer提示，输出UI可行性、方案、UX评估

等待结果。**保存SESSION_ID**（`CODEX_SESSION`和`GEMINI_SESSION`）。

综合两个分析，输出方案对比（至少2个选项），等待用户选择。

### 阶段3：详细规划

`[模式：规划]` - 多模型协作规划：

**并行调用**（使用 `resume <SESSION_ID>` 恢复会话）：
- Codex：使用architect提示 + `resume $CODEX_SESSION`，输出后端架构
- Gemini：使用architect提示 + `resume $GEMINI_SESSION`，输出前端架构

等待结果。

**Claude综合**：采用Codex后端计划 + Gemini前端计划，用户批准后保存到 `.claude/plan/task-name.md`。

### 阶段4：实现

`[模式：执行]` - 代码开发：

- 严格遵循批准的计划
- 遵循现有项目代码标准
- 在关键里程碑请求反馈

### 阶段5：代码优化

`[模式：优化]` - 多模型并行审查：

**并行调用**：
- Codex：使用reviewer提示，关注安全、性能、错误处理
- Gemini：使用reviewer提示，关注无障碍、设计一致性

等待结果。整合审查反馈，用户确认后执行优化。

### 阶段6：质量审查

`[模式：审查]` - 最终评估：

- 对照计划检查完成度
- 运行测试验证功能
- 报告问题和建议
- 请求最终用户确认

## 关键规则

1. 阶段序列不可跳过（除非用户明确指示）
2. 外部模型**零文件系统写权限**，所有修改由Claude执行
3. 评分<7或用户不批准时**强制停止**
