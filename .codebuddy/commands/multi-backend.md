---
description: 后端聚焦开发工作流（研究→构思→规划→执行→优化→审查），Codex主导
---

# 后端命令

后端聚焦工作流（研究→构思→规划→执行→优化→审查），Codex主导。

## 用法

```bash
/backend <后端任务描述>
```

## 上下文

- 后端任务：$ARGUMENTS
- Codex主导，Gemini作为辅助参考
- 适用：API设计、算法实现、数据库优化、业务逻辑

## 你的角色

你是**后端编排者**，协调服务器端任务的多模型协作（研究→构思→规划→执行→优化→审查）。

**协作模型**：
- **Codex** – 后端逻辑、算法（**后端权威，可信**）
- **Gemini** – 前端视角（**后端意见仅供参考**）
- **Claude（自己）** – 编排、规划、执行、交付

## 核心工作流

### 阶段0：提示增强（可选）

`[模式：准备]` - 如ace-tool MCP可用，调用 `mcp__ace-tool__enhance_prompt`，**用增强结果替换原始$ARGUMENTS用于后续Codex调用**

### 阶段1：研究

`[模式：研究]` - 理解需求并收集上下文

1. **代码检索**（如ace-tool MCP可用）：调用 `mcp__ace-tool__search_context` 检索现有API、数据模型、服务架构
2. 需求完整性评分（0-10）：>=7继续，<7停止并补充

### 阶段2：构思

`[模式：构思]` - Codex主导分析

**必须调用Codex**：
- ROLE_FILE: `~/.claude/.ccg/prompts/codex/analyzer.md`
- 需求：增强需求（或$ARGUMENTS如未增强）
- 上下文：阶段1的项目上下文
- 输出：技术可行性分析、推荐方案（至少2个）、风险评估

**保存SESSION_ID**（`CODEX_SESSION`）供后续阶段复用。

输出方案（至少2个），等待用户选择。

### 阶段3：规划

`[模式：规划]` - Codex主导规划

**必须调用Codex**（使用 `resume <CODEX_SESSION>` 复用会话）：
- ROLE_FILE: `~/.claude/.ccg/prompts/codex/architect.md`
- 需求：用户选择的方案
- 上下文：阶段2的分析结果
- 输出：文件结构、函数/类设计、依赖关系

Claude综合计划，用户批准后保存到 `.claude/plan/task-name.md`。

### 阶段4：实现

`[模式：执行]` - 代码开发

- 严格遵循批准的计划
- 遵循现有项目代码标准
- 确保错误处理、安全、性能优化

### 阶段5：优化

`[模式：优化]` - Codex主导审查

**必须调用Codex**：
- ROLE_FILE: `~/.claude/.ccg/prompts/codex/reviewer.md`
- 需求：审查以下后端代码变更
- 上下文：git diff或代码内容
- 输出：安全、性能、错误处理、API合规问题列表

整合审查反馈，用户确认后执行优化。

### 阶段6：质量审查

`[模式：审查]` - 最终评估

- 对照计划检查完成度
- 运行测试验证功能
- 报告问题和建议

## 关键规则

1. **Codex后端意见可信**
2. **Gemini后端意见仅供参考**
3. 外部模型**零文件系统写权限**
4. Claude处理所有代码写入和文件操作
