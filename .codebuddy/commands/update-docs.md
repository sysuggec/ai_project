---
description: 从真实来源文件同步文档与代码库
---

# 更新文档

从真实来源文件同步文档与代码库。

## 步骤1：识别真实来源

| 来源 | 生成内容 |
|------|----------|
| `package.json` scripts | 可用命令参考 |
| `.env.example` | 环境变量文档 |
| `openapi.yaml` / 路由文件 | API端点参考 |
| 源代码导出 | 公共API文档 |
| `Dockerfile` / `docker-compose.yml` | 基础设施设置文档 |

## 步骤2：生成脚本参考

1. 读取 `package.json`（或 `Makefile`、`Cargo.toml`、`pyproject.toml`）
2. 提取所有脚本/命令及其描述
3. 生成参考表：

```markdown
| 命令 | 描述 |
|------|------|
| `npm run dev` | 启动带热重载的开发服务器 |
| `npm run build` | 带类型检查的生产构建 |
| `npm test` | 运行带覆盖率的测试套件 |
```

## 步骤3：生成环境文档

1. 读取 `.env.example`（或 `.env.template`、`.env.sample`）
2. 提取所有变量及其用途
3. 分类为必需 vs 可选
4. 文档化预期格式和有效值

```markdown
| 变量 | 必需 | 描述 | 示例 |
|------|------|------|------|
| `DATABASE_URL` | 是 | PostgreSQL连接字符串 | `postgres://user:pass@host:5432/db` |
| `LOG_LEVEL` | 否 | 日志详细程度（默认：info） | `debug`、`info`、`warn`、`error` |
```

## 步骤4：更新贡献指南

生成或更新 `docs/CONTRIBUTING.md`：
- 开发环境设置（先决条件、安装步骤）
- 可用脚本及其用途
- 测试流程（如何运行、如何编写新测试）
- 代码风格强制（linter、formatter、pre-commit hooks）
- PR提交检查清单

## 步骤5：更新运维手册

生成或更新 `docs/RUNBOOK.md`：
- 部署流程（分步）
- 健康检查端点和监控
- 常见问题及其修复
- 回滚流程
- 告警和升级路径

## 步骤6：过期检查

1. 查找90天以上未修改的文档文件
2. 与最近的源代码变更交叉引用
3. 标记可能过期的文档供人工审查

## 步骤7：显示摘要

```
文档更新
──────────────────────────────
已更新：  docs/CONTRIBUTING.md (脚本表)
已更新：  docs/ENV.md (3个新变量)
已标记：  docs/DEPLOY.md (过期142天)
已跳过：  docs/API.md (未检测到变更)
──────────────────────────────
```

## 规则

- **单一真实来源**：始终从代码生成，永不手动编辑生成的部分
- **保留手动部分**：只更新生成的部分；保留手写内容不变
- **标记生成内容**：在生成部分周围使用 `<!-- AUTO-GENERATED -->` 标记
- **不要无提示创建文档**：只有在命令明确请求时才创建新文档文件
